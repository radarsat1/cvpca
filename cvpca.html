<html>
<head>
<title>CvPCA</title>
<script language="javascript">

var ws;

function open_web_socket()
{
    var text = document.getElementById('text');
    var WebSock = null;
    if (typeof MozWebSocket!=='undefined')
        WebSock = MozWebSocket;
    else
        WebSock = WebSocket;
    var url = "ws://localhost:8080";
    ws = new WebSock(url, 'phonepca');

    var onclose = function () {
        text.innerHTML = 'websocket closed <'+url+'>';

        // Try again in 3 seconds
        setTimeout(open_web_socket, 3000);
    };

    ws.onopen = function () {
        text.innerHTML = 'websocket open <'+url+'>';
        ws.send('I ' + 'Browser id?');
        var i = 0;
        var t = setInterval(function(){
            ws.send('G ' + [i++,i++,i++]);
        }, 100);
        ws.onclose = function() {
            ws.onclose = onclose;
            clearInterval(t);
            onclose();
        }
    };

    ws.onmessage = function (msg) {
        text.innerHTML = 'websocket message: '+msg.data;
    };

    ws.onclose = onclose;

    return ws;
}

function init()
{
    ws = open_web_socket();
}

</script>
</head>
<body onload="init();">
<div id='text'></div>
</body>
</html>
